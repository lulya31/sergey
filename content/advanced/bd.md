---
author:
  name: "Michael Henderson"
date: 2024-06-22
linktitle: Creating a New Theme
type:
- post
- posts
title: Базы данных
weight: 2
series:
- Hugo 101
---

---
>[*Go Back*](http://localhost:1313/advanced/)
---

---
#### [1. Реляционные базы данных](#реляционные-базы-данных)

#### [2. Нереляционные базы данных](#нереляционные-базы-данных)

##### [*2.1 Базы данных по принципу «ключ — значение*](#базы-данных-по-принципу-ключ--значение)

##### [*2.2 Документоориентированные базы данных*](#документоориентированные-базы-данных)

##### [*2.3 Графовые базы данных*](#графовые-базы-данных)

##### [*2.4 Колоночные базы данных*](#колоночные-базы-данных)

#### [3. Миграция ](#колоночные-базы-данных)
---


## **Реляционные базы данных**

Суть реляционных баз **в хранении данных в связанных таблицах.**

Эта модель используется, когда важны согласованность и высокая **нормализация данных**. 

**Нормализация БД** — это процесс организации данных определенным образом и рекомендации по проектированию.

1. **Поддержание целостности данных:** данные должны быть актуальными, последовательными и отражать реальную ситуацию. 

2. **Устранение дублирования данных:** избыточность данных не только увеличивает размеры хранилища, но и усложняет процессы обновления, добавления и удаления записей. 

3. **Упрощение структуры данных:** сложные связи и структуры затрудняют разработку, обслуживание и масштабирование системы. Упрощая структуру, мы делаем её более понятной и устойчивой к ошибкам.

4. **Гибкость в изменении и масштабировании:** при правильно выполненной нормализации база данных легко адаптируется к новым требованиям бизнеса. 

5. **Обеспечение логичной связности данных:** ссе данные и связи между ними должны иметь чёткое и понятное логическое обоснование. 


ACID в SQL обозначает набор принципов, которые обеспечивают надежность и корректность транзакций в реляционных базах данных. ACID является аббревиатурой, состоящей из четырех ключевых компонентов:

1. *Atomicity (Атомарность)*
Атомарность гарантирует, что каждая транзакция выполняется полностью или не выполняется вовсе. Если в процессе выполнения транзакции происходит ошибка, все изменения, внесенные в рамках этой транзакции, откатываются.
2. *Consistency (Согласованность)*
Согласованность обеспечивает, что транзакция переводит базу данных из одного согласованного состояния в другое, соблюдая все правила и ограничения, такие как уникальные и внешние ключи.
3. *Isolation (Изоляция)*
Изоляция гарантирует, что параллельно выполняющиеся транзакции не влияют друг на друга. Это означает, что результаты одной транзакции не должны быть видны другим транзакциям, пока первая не завершится.
4. *Durability (Долговечность)*
Долговечность обеспечивает, что после успешного завершения транзакции все изменения сохраняются, даже в случае сбоя системы.


*Когда нужно выбирать реляционную СУБД?*

- Если проектируется система, в которой требуется хранить значительное количество таблиц с различными типами связей между ними (один-к-одному, один-к-многим, многие-ко-многим).
- Если требуется высокая нормализация данных.
- Если требуется обрабатывать большое количество коротких транзакций с высокой долей операций на вставку.

*В каких случаях не стоит выбирать реляционную СУБД?*

- Если предполагается хранение неструктурируемых данных, к примеру простых структур вида «ключ-значение».
- Если есть необходимость частого обновления данных в одних и тех же строках.
  
![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/cf0/921/ae7/cf0921ae7b9b2a21098524b231b2bea6.png)

---

## **Нереляционные базы данных**


#### 1. **Базы данных по принципу «ключ — значение» (key-value store)**

В этой БД записи хранятся в парах **«ключ — значение»**, где ключ выступает *уникальным идентификатором*. Ключи и значения фиксируются в виде простой или составной информации. Эти хранилища максимально быстро реагируют на запросы информации и прекрасно масштабируются.

Такие СУБД обладают хорошим быстродействием, некоторые могут работать полностью в памяти, задавать срок жизни записи, после истечения которого запись будет удалена. Наиболее известные представители типа key-value — Redis и Memcached. 

Выбирать подобные СУБД стоит для проектов, где будут использоваться кэширование либо брокеры данных или же разработчики будут иметь дело с очень простыми структурами и необходимо получать к ним очень быстрый доступ. 

![](https://storage.yandexcloud.net/cloud-www-assets/blog-assets/ru/posts/2022/10/nosql/nosql-1.png.webp)

---

#### 2. **Документоориентированные базы данных (Document-oriented store)**
   
В БД этого типа данные записываются в документы и хранятся в формате, подобном JSON. Таким хранилищам свойственны *иерархичность* (документы складываются в коллекции, а коллекции группируются логически) и *гибкость* (значения, свойства и их структура может меняться в процессе разработки).

![](https://storage.yandexcloud.net/cloud-www-assets/blog-assets/ru/posts/2022/10/nosql/nosql-3.png.webp)

Подобные СУБД выбирают, как правило, для задач поиска по каталогу. 

Например, в MongoDB есть технология быстрого полнотекстового поиска (поиск слов или фраз в текстовых данных). Кроме того, документные СУБД хорошо подойдут в случае хранения структур, включая объекты, списки и словари, особенно в формате JSON. Однако документная СУБД не подойдет для работы с транзакциями и для формирования отчетности.


![](/mongo.png)

---

#### 3. **Графовые базы данных (graph store)**

Это достаточно специфические СУБД, предназначенные для работы с графами (с их узлами, свойствами, произвольными отношениями между узлами). Самый наглядный пример их использования — социальные сети. Наиболее распространенные графовые СУБД: Neo4j, Amazon Neptune, InfiniteGraph, InfoGrid. 

Такие СУБД необходимо выбирать, если ваш проект представляет собой что-то похожее по принципам на социальную сеть. В других случаях графовые СУБД рассматривать не стоит.

![](https://storage.yandexcloud.net/cloud-www-assets/blog-assets/ru/posts/2022/10/nosql/nosql-4.png.webp)


#### 4. **Колоночные базы данных (column family store)**
   
Основная идея этих систем — способ хранения данных не по строкам, как это реализовано в реляционных БД, а по колонкам. 

В традиционной СУБД при выполнении запроса сканируется вся таблица, а информация из всей строки извлекается целиком. В колоночных БД выгружаются только необходимые значения, поскольку поиск ведётся по отдельным столбцам. Такой подход колоночных NoSQL баз к хранению информации позволяет быстро получать данные из больших таблиц для анализа. А возможность сильного сжатия данных экономит много места на диске.

Примеры колоночных СУБД: Google Big Table, Apache HBase, Cassandra. Колоночные СУБД применяются в аналитических системах класса business intelligence и аналитических хранилищах данных (data warehouses), объемы данных могут быть достаточно большими (например, по 300-500 Тбайт). 

![](https://bigdataschool.ru/wp-content/uploads/2023/02/dbstoror1.png)

---


Миграция базы данных с изменениями схемы в процессе разработки приложения — это сложный процесс, требующий тщательного планирования и выполнения. Вот основные шаги и аспекты, которые следует учитывать:
Подготовка к миграции
Оценка изменений: Необходимо определить, какие изменения были внесены в схему базы данных. Это могут быть добавления, изменения или удаления таблиц, полей и индексов.
Создание миграционных скриптов: На основе изменений схемы разрабатываются миграционные скрипты, которые будут применяться для обновления структуры базы данных. Эти скрипты должны быть протестированы на тестовых окружениях.
Версионирование миграций: Важно использовать систему версионирования для отслеживания изменений схемы. Это позволяет избежать конфликтов и упростить процесс отката, если что-то пойдет не так.
Процесс миграции
Планирование времени миграции: Миграция должна проводиться в период минимальной нагрузки на систему, чтобы минимизировать влияние на пользователей.
Горячая или холодная миграция: В зависимости от требований приложения, миграция может быть "горячей" (с возможностью записи данных во время миграции) или "холодной" (при полной остановке приложения). Горячая миграция требует более сложной архитектуры и синхронизации данных между старой и новой схемами.
Применение миграционных скриптов: Скрипты применяются к базе данных, в результате чего происходит изменение схемы. Важно следить за процессом и фиксировать возможные ошибки.
Тестирование и валидация
Тестирование после миграции: После применения миграций необходимо проводить тестирование, чтобы убедиться, что все изменения были успешно применены и что приложение работает корректно с новой схемой.
Мониторинг производительности: Важно следить за производительностью базы данных после миграции, чтобы выявить возможные проблемы, связанные с изменениями схемы.
Откат миграции: В случае возникновения критических ошибок, необходимо иметь возможность откатить изменения. Это требует предварительного создания резервных копий и тестирования процесса отката.

Существует 2 типа процесса миграции:

Однократная миграция подразумевает разовое перемещение. Нюанс этого процесса заключается в том, что база данных переносится из одной системы в другую. При этом поддержка первой системы, из которой выполнили перенос, прекращается.
Версионная миграция данных. При данном типе база данных обновляется до новой версии. Помимо апгрейда, может быть откат к более старым версиям. Также данный тип миграции затрагивает схему, о которой более подробно рассказали в разделе «Основные понятия».

Полная миграция баз данных
При такой миграции база данных переносится полностью из источника в приемник. Чтобы осуществить данный вид миграции, необходимо выбрать технологию переноса, определить правила настройки доступа, подумать над постмиграционном тестировании и устранением недочетов. Также нужно оценить объем и состав данных, которые необходимо перенести. Все это относится к организационным моментам, чтобы сам процесс был четко организованным и непрерывным.

Помимо организационных вопросов, нужно задуматься над планом Б, если произойдет внештатная ситуация. К примеру, в процессе переноса случаются сбои, которые влекут за собой нарушение целостности, а также корректности данных. В этом случае в качестве плана Б необходимо вспомнить о методах отката баз данных к исходной версии.

И, конечно же, очень важно, чтобы работу выполнял высококвалифицированный персонал. Участники процесса должны быть поделены на 2 рабочие группы, каждая из которых будет разбираться в своей системе управления базами данных. Независимо от того, осуществляется процесс в автоматическом режиме или вручную, необходимо назначить сотрудников для мониторинга.

Также к технологическим моментам можно отнести следующее:

Если источников выгрузки данных несколько, требуется подготовить их список, согласовав его заранее.
Перед выгрузкой данных рекомендуется проводить предварительное тестирование и комплексный аудит. Чтобы определить скорость процесса и какие факторы на нее влияют. Процессы выгрузки не должен затягиваться.
Подготовить шаблоны загрузки данных с техническими описаниями.
Сопоставить исходные и загрузочные данные. Чаще всего процесс Data mapping занимает практически половину объема всего процесса. На этом этапе в виде скриптов создают правила преобразования данных, которые подлежат переносу.
После прохождения вышеописанных этапов данные готовы к выгрузке из источника. В процессе они трансформируются и затем перемещаются в приемник. Как мы и говорили, первоначально лучше сделать пробную миграцию с внесением корректив.
Заключительный этап включает в себя сверку данных. Это необходимо, чтобы проверить работоспособность данных.

Версионная миграция
Чаще всего версионную миграцию выбирают в случаях, когда необходимо контролировать версии программного обеспечения, если над разработкой программного обеспечения трудится команда специалистов, а не отдельный разработчик. Именно версионная миграция помогает не столкнуться с рассинхронизацией, когда новые версии программного обеспечения отправляются в продакшн. Также у данной процедуры есть следующие нюансы, о которых нужно знать и учитывать в работе: при переносе данных важно соблюдать последовательность, все SQL-запросы должны выполняться один раз. Если не придерживаться этих условий, то можно столкнуться с потерей данных и потратить время на их восстановление.

Допустим, вам нужно выполнить версионную миграцию. Чтобы это сделать, нужно выбрать подходящий для вас метод:

Метод инкрементных изменений.
Метод идемпотентных изменений.
уподобление структуры базы данных исходному коду.

Чтобы облегчить процесс переноса и избежать ошибок, были разработаны специальные наборы инструментов для каждого метода в отдельности.

Как выбрать правильный метод? Для этого нужно руководствоваться рядом принципов:

для каждой версии базы данных должно быть предусмотрено обновление до новых версий, а при необходимости откат на предыдущие версии;
упрощенное получение SQL-запросов;
нужно предусмотреть возможность создания базы данных с обновленной структурой с чистого листа;
рекомендуем продумывать миграцию базы данных таким образом, чтобы избежать редактирования вручную.
Ознакомившись с теорией, можно переходить к практике. Ниже представлены две инструкции по переносу баз данных.

https://habr.com/ru/articles/121265/