+++
categories = ["Hugo"]
date = "2024-07-22"
description = ""
featured = "pic03.jpg"
featuredalt = "Pic 3"
featuredpath = "date"
linktitle = ""
slug = "Debuter avec Hugo"
title = "Брокеры сообщений"
type = "post"
[ author ]
  name = "Брокеры сообщений"
+++

---
>[*Go Back*](http://localhost:1313/advanced/)
---

---
#### [1. Брокеры сообщений](#брокеры-сообщений)

#### [2. Kafka ](#kafka)

#### [3. MQ ](#mq)
---

## Брокеры сообщений

Брокер сообщений или очередь сообщений - это программа (ПО), которая служит посредником между сервисами одной или нескольких систем. Использование подобных систем стало особенно актуально с развитием микросервисной архитектуры.

Брокер сообщений можно представить как "чёрный ящик", в который кто-то кладёт данные, а кто-то другой забирает эти данные. 


![](https://ucarecdn.com/7c753d04-06bd-4eaa-98a2-00ad13c04733/)

*Зачем нужны брокеры сообщений?*

**Асинхронное взаимодействие**
Очереди сообщений позволяют сервисам обмениваться данными асинхронно в отличии от взаимодействия по HTTP. То есть отправитель не ждёт мгновенного ответа от получателя (и не останавливает свою работу во время ожидания), а может дальше продолжать свою работу. 

**Надёжность**
Благодаря специальным механизмам (они будут рассмотрены в следующих уроках), брокеры могут гарантировать доставку сообщений даже в случае временных сбоев (в отличие от HTTP), а также могут поддерживать очерёдность этих сообщений.

**Гибкость масштабирования**
При использовании брокеров легко масштабировать систему без значительных изменений в архитектуре.

---

## Kafka

![](https://selectel.ru/blog/wp-content/uploads/2022/04/img2-2.png)

Событие или сообщение — данные, которые поступают из одного сервиса, хранятся на узлах Kafka и читаются другими сервисами. Сообщение состоит из:

Key — опциональный ключ, нужен для распределения сообщений по кластеру.
Value — массив байт, бизнес-данные.
Timestamp — текущее системное время, устанавливается отправителем или кластером во время обработки.
Headers — пользовательские атрибуты key-value, которые прикрепляют к сообщению.
Продюсер — поставщик данных, который генерирует сообщения — например, служебные события, логи, метрики, события мониторинга.

Консьюмер — потребитель данных, который читает и использует события, пример — сервис сбора статистики.

продюсер (producer) — приложение или процесс, генерирующий и посылающий данные (публикующий сообщение);
потребитель (consumer) — приложение или процесс, который принимает сгенерированное продюсером сообщение;
сообщение — пакет данных, необходимый для совершения какой-либо операции (например, авторизации, оформления покупки или подписки);
брокер — узел (диспетчер) передачи сообщения от процесса-продюсера приложению-потребителю;
топик (тема) — виртуальное хранилище сообщений (журнал записей) одинакового или похожего содержания, из которого приложение-потребитель извлекает необходимую ему информацию.

Приложение-продюсер создает сообщение и отправляет его на узел Kafka.
Брокер сохраняет сообщение в топике, на который подписаны приложения-потребители.
Потребитель при необходимости делает запрос в топик и получает из него нужные данные.

![](https://blog.skillfactory.ru/wp-content/uploads/2023/02/kafka-1-2083805.png)

---

## MQ

RabbitMQ — это брокер сообщений, который помогает разным сервисам эффективно и надежно обмениваться данными. Он работает по принципу асинхронной обработки информации, что позволяет сервисам не зависеть друг от друга и продолжать работу без ожидания ответа. RabbitMQ обеспечивает гибкость маршрутизации сообщений, их сохранность и легкую масштабируемость, что делает его незаменимым инструментом для создания сложных распределенных систем.

RabbitMQ состоит из нескольких основных компонентов: очередь (Queue), сообщение (Message), обменник (Exchange), биндинг (Binding), паблишер (Publisher), получатель (Consumer).


![](https://blog.skillfactory.ru/wp-content/uploads/2024/04/message-queue-small.png)

Очередь (Queue) — это структура данных, где хранятся сообщения до того, как получатель их обработает. Очередь может быть временной или постоянной, в зависимости от потребностей приложения.

Сообщение (Message) — это единица данных, которая передается от издателя к подписчику через очередь. Сообщения могут быть разных типов и форматов.

Обменник (Exchange) — это компонент, который принимает сообщения от издателей и направляет их в соответствующие очереди.

Биндинг (Binding) — это связь между обменником и очередью, которая определяет, какие сообщения в какую очередь будут направлены.

Продюсер (Producer) — это приложение, которое публикует сообщения в обменник.

Получатель (Consumer) — это приложение, которое получает сообщения из очереди и обрабатывает их.

Работа RabbitMQ происходит следующим образом:

продюсер отправляет сообщение в обменник;
обменник направляет сообщение в соответствующую очередь, в зависимости от типа обмена и биндинга;
получатель подписывается на очередь и начинает получать сообщения из нее;
получатель обрабатывает сообщения и выполняет необходимые действия;
получатель подтверждает получение сообщения, чтобы исключить его из очереди;
если сообщение не было подтверждено в течение определенного времени, оно будет повторно отправлено в очередь.


|Категория|RabbitMQ|Apache Kafka|
|---|----|---|
|Сложность|Удобный интерфейс, легкая установка, в том числе в Docker, легкая настройка|Сложность запуска и настройки, отсутствие веб-интерфейса|
|Специфика инструмента|Брокер сообщений, заточен под работу с отдельными сообщениями|Платформа для передачи и обработки событий, заточена под работу с потоками сообщений|
|Работа с очередями|Пуш-модель получения сообщений: RabbitMQ сам отправляет информацию клиенту без запроса со стороны последнего|Пулл-модель получения сообщений: клиент сам запрашивает у Apache Kafka новые данные, инициируя соединение и получая только те сообщения, которые были запрошены |
|Гарантия доставки сообщения|RabbitMQ ждет от получателя подтверждение, что сообщение доставлено, или сигнал о неудачной доставке. Во втором случае сообщение остается в очереди до тех пор, пока не будет доставлено|Kafka не отслеживает, получил ли подписчик сообщение, платформа просто хранит его в течение установленного промежутка времени. При этом она гарантирует, что сообщения находятся в той же последовательности, в которой поступили|
|Хранение данных|Есть хранение данных, можно посмотреть историю сообщений|Нет хранения данных, сообщения удаляются по истечении определенного, заранее заданного, времени|
|Протокол|RabbitMQ поддерживает несколько стандартизированных протоколов: AMQP, MQTT, STOMP и др. Это позволяет заменить его на любой брокер на основе AMQP|Kafka использует пользовательский протокол поверх TCP/IP для связи между приложениями и кластером. Вы не сможете так просто удалить или заменить эту платформу, потому что она единственная реализует данный протокол |


Применение

RabbitMQ сосредотачивается на надежной и гибкой передаче сообщений между различными частями системы. Это делает его хорошим выбором для архитектур, где требуется точная доставка сообщений, обработка структурированных данных и контроль над обменом сообщениями между компонентами.
RabbitMQ подходит для нетривиальных бизнес-процессов и позволяет настраивать сложные системы с тысячами источников и приемников сообщений 
Где может применяться: системы бронирования билетов, логистические программы

Основное назначение Apache Kafka — централизованный сбор, обработка, безопасное хранение и передача сообщений от разных сервисов. Обычно систему выбирают, когда нужно работать с большим количеством неструктурированных данных.
Где может применяться: системы аналитики, финансовые системы, социальные сети, онлайн-игры

---