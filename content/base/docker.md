+++
title = "Docker"
date = "2024-07-22"
aliases = ["about-us","about-hugo","contact"]
[ author ]
  name = "Hugo Authors"
+++

---
>[*Go Back*](http://localhost:1313/base/)
---

### [1. Docker](#docker)

### [2. Dockerfile](#dockerfile)

### [3. Docker compose](#docker-compose)

### [4. K8s](#k8s)

### [5 Lens](#lens)

---

## Docker
это платформа для контейнеризации приложений, которая позволяет упаковать приложение и его зависимости в единый контейнер. Этот контейнер можно запустить на любой системе, поддерживающей Docker, и он будет работать идентично независимо от окружения. 

**Образ (Image):** Образ - это статический файл, содержащий все необходимое для запуска приложения, включая код, библиотеки и зависимости.

**Контейнер (Container):** Контейнер - это экземпляр образа, который можно запустить и остановить.

**Docker Hub:** - это облачное хранилище образов Docker, которое позволяет делиться и загружать образы.

#### Основные команды Docker

1. docker pull - для загрузки образа с Docker Hub.
2. docker run - для запуска контейнера из образа.
3. docker ps - выводит список запущенных контейнеров.
4. docker stop - используется для остановки контейнера.
5. docker rm - удаляет контейнер. 
6. docker images - выводит список загруженных образов.

---

## Docker File

*Dockerfile* представляет из себя текстовый документ содержащий все команды для сборки образа.

- **FROM** — задаёт базовый (родительский) образ.
- **LABEL** — описывает метаданные. Например — сведения о том, кто создал и поддерживает образ.
- **ENV** — устанавливает постоянные переменные среды.
- **RUN** — выполняет команду и создаёт слой образа. Используется для установки в контейнер пакетов.
- **COPY** — копирует в контейнер файлы и папки.
- **ADD** — копирует файлы и папки в контейнер, может распаковывать локальные .tar-файлы.
- **CMD** — описывает команду с аргументами, которую нужно выполнить когда контейнер будет запущен. Аргументы могут быть переопределены при запуске контейнера. В файле может присутствовать лишь одна инструкция CMD.
- **WORKDIR** — задаёт рабочую директорию для следующей инструкции.
- **ARG** — задаёт переменные для передачи Docker во время сборки образа.
- **ENTRYPOINT** — предоставляет команду с аргументами для вызова во время выполнения контейнера. Аргументы не переопределяются.
- **EXPOSE** — указывает на необходимость открыть порт.
- **VOLUME** — создаёт точку монтирования для работы с постоянным хранилищем.

---

## Docker Compose

*Docker Compose* - это инструмент, который упрощает управление многоконтейнерными приложениями с использованием Docker. Он позволяет вам определить и настроить все контейнеры, сети и объемы для вашего приложения в одном файле конфигурации в формате YAML, а затем запустить их одной командой.

**docker-compose up:** Запускает приложение на основе файла docker-compose.yml. Если контейнеры не существуют, они будут созданы, и приложение будет запущено в фоновом режиме.

**docker-compose down:** Останавливает и удаляет все контейнеры, сети и объемы, связанные с приложением, определенным в файле docker-compose.yml.

**docker-compose ps:** Показывает статус всех сервисов, определенных в файле docker-compose.yml.

**docker-compose logs:** Отображает логи всех сервисов в реальном времени.

> ##### Dockerfile

![](/docker/dockerfile.png)

> ##### Docker compose

![](/docker/compose.png)

> ##### Container

![](/docker/container.png)

> ##### Docker Hub

![](/docker/hub.png)

---

## K8s

**Kubernetes (K8s)** — это программная платформа для автоматического управления контейнеризованными приложениями. 

*Возможности Kubernetes*

1. **Наблюдение за работой сервисов**. Платформа позволяет следить как за отдельными приложениями, так и за всем кластером сразу. K8s имеет веб-интерфейс. Все данные о работе сервисов система предоставляет разработчику в интуитивно понятном виде.

2. **Распределение нагрузки.** Трафик, который потребляют контейнеры, может различаться. Это негативно влияет на развертывание приложений. Kubernetes автоматически отслеживает нагрузку в контейнерах, и если в каком-то из них обнаруживается высокий трафик, то платформа распределяет его между другими контейнерами. 

3. **Оркестрация хранилища.** С помощью Kubernetes разработчик может выбрать систему хранения: локальное хранилище, облако и т.д. Платформа автоматически создаст ее и настроит под потребности проекта.
   
4. **Развертывание и откаты**. Платформа позволяет развертывать приложения в автоматическом и ручном режимах. Есть вариант канареечного развертывания, когда изменения, внесенные разработчиком, применяются только на некоторой части контейнеров. Такое решение позволяет осторожно тестировать обновления. Изменения можно автоматически откатить.

5. **Самоконтроль**. Если контейнер отказывает или сбоит, Kubernetes автоматически перезапускает или останавливает его. Освободившиеся ресурсы она распределяет на другие приложения. Система контролирует их работу в соответствии с критериями, заданными разработчиком. Если контейнер не соответствует им, платформа отключает его или заменяет на другой, а также скрывает от клиента, пока он не будет готов к обслуживанию.

6. **Безопасность и конфиденциальность.** Kubernetes может сохранять и контролировать конфиденциальные данные (пароли, ключи SSH, OAuth-токены), распределять права доступа к системе. Обновление и развертывание приложений не затрагивает образы контейнеров и не раскрывает секретные сведения в конфигурации стека.


**Основные объекты кластера Kubernetes**

![](https://blog.skillfactory.ru/wp-content/uploads/2023/02/kubernetes-2-7454350.png)

- **Nodes (ноды, узлы)**
Это физические или виртуальные машины, на которых развертываются и запускаются контейнеры с приложениями. Совокупность нод образует **кластер** Kubernetes.

**Nodes бывают двух типов:**

- **Master (мастер-нода)** — узел, управляющий всем кластером. Он следит за остальными нодами и распределяет между ними нагрузку с помощью менеджера контроллеров (controller manager) и планировщика (scheduler). 

- **Worker (рабочие ноды)** — узлы, на которых работают контейнеры. 

![](https://blog.skillfactory.ru/wp-content/uploads/2023/02/kubernetes-3-9401197.png)

- **Pods (Поды)**

Это абстрактный объект Kubernetes, представляющий собой «обертку» для одного или группы контейнеров. Контейнеры в поде запускаются и работают вместе, имеют общие сетевые ресурсы и хранилище. Kubernetes не управляет контейнерами напрямую, он собирает их в поды и работает с ими.
![](https://blog.skillfactory.ru/wp-content/uploads/2023/02/kubernetes-4-2873366.png)

**Основные компоненты кластера**
![](https://blog.skillfactory.ru/wp-content/uploads/2023/02/kubernetes-6-8004460.png)

*Компоненты* — это службы, модули и программы, обеспечивающие работу всего кластера. Они работают в нодах, то есть на виртуальных или физических серверах, где используется Kubernetes.

**Кластер Kubernetes включает следующие компоненты:**

- *kube-apiserver.* С помощью сервера API обеспечивается работа API кластера, обрабатываются REST-операции и предоставляется интерфейс, через который остальные компоненты взаимодействуют друг с другом. Также через него проходят запросы на изменение состояния или чтение кластера. Работает на master-нодах;
  
- *kube-scheduler.* Компонент, планирующий, на каких узлах разворачивать поды. Он учитывает такие факторы, как ограничения, требования к ресурсам, местонахождение данных и пр. Работает на master-нодах;
  
- *etcd.* Распределенное хранилище в формате «ключ-значение». В нем хранится состояние всего кластера. Главная задача etcd — обеспечить отказоустойчивость кластера и консистентность данных. Etcd — самостоятельный проект. Он развивается отдельно от Kubernetes и применяется в разных продуктах. Работает на master-нодах;

- *kube-proxy.* Служба, которая управляет правилами балансировки нагрузки. Она конфигурирует правила IPVS или iptables, через которые выполняются проксирование и роутинг. Работает на worker-нодах;

- *kube-controller-manager.* Компонент запускает работу контроллеров. Работает на master-нодах;

- *kubelet.* Cлужба, которая управляет состоянием ноды: запуском, остановкой и поддержанием работы контейнеров и подов. Работает на worker-нодах.

---

## Lens

> *Настройка портов:*

![](/lens_bd/lens.png)

> *Локальное подключене к БД:*

![](/lens_bd/bd.png)